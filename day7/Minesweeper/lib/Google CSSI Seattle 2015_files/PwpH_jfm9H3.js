/*!CK:1172476773!*//*1437773148,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["\/y7AB"]); }

__d("GroupSellComposerActionEvents",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={COMPOSER_LOAD:"composer_load",LAUNCH_SELL_COMPOSER:"launch_sell_composer",SELL_COMPOSER_POST_TO_MARKETPLACE_SEEN:"sell_composer_post_to_marketplace_seen",LAUNCH_NORMAL_COMPOSER:"launch_normal_composer",COMPOSER_FILL_TITLE:"composer_fill_title",COMPOSER_FILL_PRICE:"composer_fill_price",COMPOSER_FILL_DESCRIPTION:"composer_fill_description",COMPOSER_FILL_PICKUP_NOTE:"composer_fill_pickup_note",COMPOSER_FILL_CATEGORY:"composer_fill_category",COMPOSER_LOCATION_DEFAULT_TYPE:"composer_location_default_type",COMPOSER_ADD_PHOTO:"composer_add_photo",COMPOSER_DELETE_PHOTO:"composer_delete_photo",COMPOSER_SUBMIT:"composer_submit",COMPOSER_SUBMIT_ENABLED:"composer_submit_enabled",COMPOSER_FILL_DESCRIPTION_REGULAR:"composer_fill_description_regular",COMPOSER_ADD_PHOTO_REGULAR:"composer_add_photo_regular",COMPOSER_DELETE_PHOTO_REGULAR:"composer_delete_photo_regular",COMPOSER_SUBMIT_REGULAR:"composer_submit_regular",COMPOSER_INVALID_FIELD_SUBMISSION:"composer_invalid_field_submission",GROUP_POST:"group_post",GROUP_NON_FOR_SALE_POST:"group_non_for_sale_post",COMPOSER_TUTORIAL_VIDEO_SHOW:"composer_tutorial_video_show",COMPOSER_TUTORIAL_VIDEO_COMPLETE:"composer_tutorial_video_complete",COMPOSER_TUTORIAL_VIDEO_CONFIRM:"composer_tutorial_video_confirm",COMPOSER_TUTORIAL_VIDEO_CLOSE:"composer_tutorial_video_close",COMPOSER_TUTORIAL_VIDEO_NO_FLASH:"composer_tutorial_video_no_flash"};},null);
__d("ComposerXHiddenInputClear",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(h){h.element.value='';}e.exports=g;},null);
__d("ComposerXSessionInputClear",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(h){h.element.value=(new Date()).valueOf().toString().substr(0,10);}e.exports=g;},null);
__d("ComposerTagSuggestionsWaterfall",["Banzai"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h='composer_tag_suggestions';function i(j){"use strict";this._waterfallID=j;}i.prototype.setWaterfallID=function(j){"use strict";this._waterfallID=j;};i.prototype._logStep=function(j,k){"use strict";k=Object.assign({},(k||{}),{waterfall_id:this._waterfallID,step:j});g.post(h,k);return this;};i.prototype.logBegin=function(){"use strict";return this._logStep('begin');};i.prototype.logAddPhoto=function(j){"use strict";return this._logStep('add_photo',{photo:j});};i.prototype.logAddPhotos=function(j){"use strict";j.forEach(this.logAddPhoto.bind(this));};i.prototype.logRemovePhoto=function(j,k,l){"use strict";return this._logStep('remove_photo',{photo:j,tokens:k,suggestions:l});};i.prototype.logAddToken=function(j,k){"use strict";return this._logStep('add_token',{user:j,replaced_with_tag:k});};i.prototype.logRemoveToken=function(j,k){"use strict";return this._logStep('remove_token',{user:j,suggestions:k});};i.prototype.logAddSuggestion=function(j,k,l,m){"use strict";return this._logStep('add_suggestion',{photo:j,facebox:k,user:l,certainty:m});};i.prototype.logRemoveSuggestion=function(j,k,l,m){"use strict";return this._logStep('remove_suggestion',{photo:j,facebox:k,user:l,certainty:m});};i.prototype.logAddManualTag=function(j,k,l){"use strict";return this._logStep('add_tag',{photo:j,facebox:k,user:l});};i.prototype.logRemoveManualTag=function(j,k,l){"use strict";return this._logStep('remove_tag',{photo:j,facebox:k,user:l});};i.prototype.logStartPoll=function(j){"use strict";return this._logStep('start_poll',{photos:j});};i.prototype.logStopPoll=function(j,k){"use strict";return this._logStep('stop_poll',{time_spent:j,unresolved_photos:k});};i.prototype.logSubmit=function(j,k,l,m,n,o){"use strict";return this._logStep('submit',{photos:j,tokens:k,manual_tokens:l,suggestions:m,manual_tags:n,time_spent:o});};i.prototype.logFailure=function(j,k){"use strict";return this._logStep('fail',{photo:j,user:k});};e.exports=i;},null);
__d("AttachmentWithPhotoEditorTaggingMixin",["Arbiter","ComposerTagSuggestionsWaterfall","DOM","Form","Parent","PhotoTagStore","SubscriptionsHandler"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();e.exports={initPhotoEditorTaggingMixin:function(){this._tagStore=l.getInstance();this._photoEditorTagging={};this._photoEditorTagging.uploadArea=this.getUploadArea();this._photoEditorTagging.xyTagInputs={};this._photoEditorTagging.subscriptions=new m();var n=this.getWaterfallID();this._photoEditorTagging.tagSuggestionsWaterfall=new h(n);this._photoEditorTagging.tagSuggestionsWaterfall.logBegin();this._photoEditorTagging.flowBeginTimestamp=Date.now();this._photoEditorTagging.subscriptions.addSubscriptions(g.subscribe('AttachmentsPhotoEditor/tagsUpdated'+this.getGridID(),this._onTagsUpdatedForPhoto.bind(this)),g.subscribe('multi-upload/images-added/'+this.getGridID(),this._onImageAdded.bind(this)),g.subscribe('multi-upload/image-removed/'+this.getGridID(),this._onImageRemoved.bind(this)));var o=this.getComponentInstance('withtagger');if(o)this._photoEditorTagging.subscriptions.addSubscriptions(o.subscribe('removeToken',this._onTokenRemoved.bind(this)));this._tagStore.clear();this._taggingFlyoutData=this._photoEditorTagging;},_onTagsUpdatedForPhoto:function(n,o){var p=o.fbid,q=o.tags,r=false,s=this.getComponentInstance('withtagger');this._removeTagsForPhoto(p);q.forEach(function(t){r=this._tagStore.userHasDirtyTags(t.subject);t.fbid=p;this._tagStore.storeTagWithOptions(p,t.subject,t.x,t.y,t);if(s&&!r)s.replaceToken(s.createDecorativeToken({uid:t.subject,text:t.name},'faceSuggestion'));}.bind(this));g.inform('AttachmentsPhotoEditor/tagStateChanged'+p,!!q.length);this._updateXYTagsInputs();},_onImageAdded:function(){if(this.getComponent('withtagger'))this.getTagger().eventuallySwitchToTagger('with');},_onImageRemoved:function(n,o){this._removeTagsForPhoto(o);this._updateXYTagsInputs();},_removeTagsForPhoto:function(n){var o=this.getComponentInstance('withtagger'),p;if(o){p=Object.keys(this._tagStore.getPhotoTags(n));this._tagStore.removeAllTagsFromPhoto(n);p.forEach(function(q){if(!this._tagStore.userHasDirtyTags(q))o.removeToken(o.findToken({uid:q}));}.bind(this));}},_updateXYTagsInputs:function(){var n=k.byTag(this.getSubmitButton(),'form');this._removeAllXYTagInputs();var o=this._tagStore.getAllTags();j.createHiddenInputs({xy_tags:o},n,this._photoEditorTagging.xyTagInputs);},_removeAllXYTagInputs:function(){for(var n in this._photoEditorTagging.xyTagInputs)i.remove(this._photoEditorTagging.xyTagInputs[n]);this._photoEditorTagging.xyTagInputs={};},_onTokenRemoved:function(n,o){var p=o.info.uid,q=this._tagStore.removeAllNewTagsOfUser(p);q.forEach(function(r){if(!this._tagStore.photoHasTags(r.fbid))g.inform('AttachmentsPhotoEditor/tagStateChanged'+r.fbid,false);}.bind(this));this._updateXYTagsInputs();},cleanupPhotoEditorTagging:function(){this._photoEditorTagging.subscriptions.release();this._photoEditorTagging.subscriptions.engage();},resetPhotoEditorTagging:function(){this._tagStore.clear();this._removeAllXYTagInputs();}};},null);
__d("InstanceRegistry",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(){"use strict";this.instances={};this.waits=[];}g.prototype.set=function(h,i){"use strict";this.instances[h]=i;this.waits=this.waits.filter(function(j){if(this._isWaitResolved(j.names)){j.callback.apply(this,this._mapNamesToInstances(j.names));return false;}return true;}.bind(this));};g.prototype.get=function(h){"use strict";return this.instances[h];};g.prototype.remove=function(h){"use strict";delete this.instances[h];};g.prototype.waitFor=function(h,i){"use strict";if(this._isWaitResolved(h))return i.apply(this,this._mapNamesToInstances(h));this.waits.push({names:h,callback:i});};g.prototype.waitForAndRemove=function(h,i){"use strict";this.waitFor(h,function(){i.apply(this,arguments);h.forEach(this.remove.bind(this));}.bind(this));};g.prototype._isWaitResolved=function(h){"use strict";return h.every(this.instances.hasOwnProperty.bind(this.instances));};g.prototype._mapNamesToInstances=function(h){"use strict";return h.map(function(i){return this.instances[i];}.bind(this));};e.exports=new g();},null);
__d("PhotosTaggingFlyoutLoader",["ArbiterMixin","AsyncRequest","InstanceRegistry","URI","arrayContains","mixin","removeFromArray"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=l(g);for(var o in n)if(n.hasOwnProperty(o))q[o]=n[o];var p=n===null?null:n.prototype;q.prototype=Object.create(p);q.prototype.constructor=q;q.__superConstructor__=n;function q(r){"use strict";n.call(this);this._flyouts={};this._loading=[];this._callbacks={};this._targetID=r;}q.prototype.get=function(r,s){"use strict";if(this._isLoaded(r))return s(this._flyouts[r]);this._callbacks[r]=this._callbacks[r]||[];if(!this._isLoading(r))this._load(r);this._callbacks[r].push(s);};q.prototype.whenLoaded=function(r,s){"use strict";if(this._isLoaded(r))return s(this._flyouts[r]);this._callbacks[r]=this._callbacks[r]||[];this._callbacks[r].push(s);};q.prototype._load=function(r){"use strict";if(this._isLoading(r))return;this._loading.push(r);new h().setURI(new j('/ajax/photos/tagging-flyout/').addQueryData({photo:r,target:this._targetID,recognitionFeature:'composer_facerec'})).setHandler(function(){i.waitForAndRemove(['PhotosTaggingFlyout_'+r],function(s){if(!this._isLoading(r))return;this.inform('loaded',s);this._flyouts[r]=s;this._callbacks[r].forEach(function(t){t(s);});delete this._callbacks[r];}.bind(this));}.bind(this)).setFinallyHandler(function(){m(this._loading,r);}.bind(this)).send();};q.prototype._isLoading=function(r){"use strict";return k(this._loading,r);};q.prototype._isLoaded=function(r){"use strict";return !!this._flyouts[r];};q.prototype.remove=function(r){"use strict";if(this._isLoaded(r))this._flyouts[r].cleanup();delete this._flyouts[r];delete this._callbacks[r];m(this._loading,r);};q.prototype.cleanup=function(){"use strict";Object.keys(this._flyouts).forEach(this.remove.bind(this));Object.keys(this._callbacks).forEach(this.remove.bind(this));};e.exports=q;},null);
__d("FaceRecognitionController",["ArbiterMixin","BanzaiODS","Poller","mixin","removeFromArray"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=j(g);for(var m in l)if(l.hasOwnProperty(m))o[m]=l[m];var n=l===null?null:l.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=l;function o(p){"use strict";l.call(this);this._config=Object.assign({uri:'/photos/tagging/recognition/',interval:2000,maxRequests:4,targetIsPage:false,targetID:null},p);this._cleanup();this._poller=new i({dontStart:true,maxRequests:this._config.maxRequests,interval:this._config.interval,setupRequest:function(q){q.setURI(this._config.uri).setData({recognition_project:'composer_facerec',photos:this._pendingPhotos,waterfallID:this._config.waterfallID,target:this._config.targetID,is_page:this._config.targetIsPage,include_unrecognized_faceboxes:!!this._config.include_unrecognized_faceboxes,include_face_crop_src:!!this._config.include_face_crop_src,include_recognized_user_profile_picture:!!this._config.include_recognized_user_profile_picture,include_low_confidence_recognitions:!!this._config.include_low_confidence_recognitions}).setHandler(this._handleResponse.bind(this));}.bind(this)});this._poller.subscribe('done',function(){var q=this._pendingPhotos;this._cleanup();this.inform('done',{unresolved:q});}.bind(this));}o.prototype.setWaterfallID=function(p){"use strict";this._config.waterfallID=p;};o.prototype.start=function(p){"use strict";Array.prototype.push.apply(this._pendingPhotos,p);this._poller.reset();this._resetSafeguardTimeout();};o.prototype.stop=function(){"use strict";this._poller.stop();this._cleanup();};o.prototype._cleanup=function(){"use strict";window.clearTimeout(this._safeguardTimeout);this._safeguardTimeout=null;this._pendingPhotos=[];};o.prototype._resetSafeguardTimeout=function(){"use strict";window.clearTimeout(this._safeguardTimeout);this._safeguardTimeout=window.setTimeout(function(){h.bumpEntityKey('composer_facerec','safeguard');var p=this._pendingPhotos;this._poller.stop();this._cleanup();this.inform('done',{unresolved:p});}.bind(this),(this._config.maxRequests+2)*this._config.interval);};o.prototype._handleResponse=function(p){"use strict";var q=p.getPayload();q.forEach(function(r){var s=0;k(this._pendingPhotos,r.fbid);r.faceboxes.forEach(function(t){s+=t.recognitions.length;t.recognitions.forEach(function(u){this.inform('recognition',{photo:r.fbid,facebox:{fbid:t.fbid,x:t.x,y:t.y},recognition:u});}.bind(this));}.bind(this));this.inform('photo',{photo:r.fbid,faceboxes:r.faceboxes,recognitions:s});}.bind(this));if(!this._pendingPhotos.length){this._poller.stop();this._cleanup();this.inform('done',{unresolved:this._pendingPhotos});}};e.exports=o;},null);
__d("ComposerXNUX",["AsyncRequest","ComposerXDragDropUtils","CSS","DOM","Event","SubscriptionsHandler","csx","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o={},p={};function q(s,t,u){var v=u.dataTransfer.items;if(v){var w=h.filterImages(v);if(!w.length)return;}r.acknowledgeDialog(s,t);}var r={CAMERA_NUX:'camera_nux_seen',ADD_MORE_NUX:'add_more_nux_seen',HMU_NUX:'hmu_nux_seen',HMU_POST_NUX:'hmu_post_nux_seen',FACEREC_SUGGESTIONS_NUX:'facerec_suggestions_nux_seen',TAGGING_FLYOUT_NUX:'tagging_flyout_nux_seen',OGCOMPOSER_NEW_ICON_PICKER_NUX:'minutiae_icon_picker_nux_seen',SHARER_MINUTIAE_NUX:'sharer_minutiae_nux_seen',ADD_STICKERS_NUX:'add_stickers_nux_seen',UPCOMING_BIRTHDAYS_NUX:'upcoming_birthdays_nux_seen',onInit:function(s,t,u){if(o[u])return;p[u]=p[u]||new l();var v=p[u];v.engage();var w=s.getRoot();i.addClass(w,"_4bka");var x=j.scry(w,"._3o-a");x.forEach(function(y){v.addSubscriptions(k.listen(y,'click',r.acknowledgeDialog.bind(null,u,s)));});if(u==r.CAMERA_NUX)v.addSubscriptions(k.listen(document,'dragenter',q.bind(null,u,s)));v.addSubscriptions(s.subscribe('cancel',r.sendMarkSeenRequest.bind(null,u)),s.subscribe('hide',v.release.bind(v)));s.setContext(t).show();},acknowledgeDialog:function(s,t){r.sendMarkSeenRequest(s);t.hide();},sendMarkSeenRequest:function(s){if(!o[s]){new g('/ajax/photos/composer/mark_nux_seen.php').setData({type:s}).send();o[s]=true;}},onCleanup:function(s){s.hide();}};e.exports=r;},null);
__d("AttachmentWithPhotosTaggingFlyoutMixin",["Event","Arbiter","PhotoTagStore","ComposerTagSuggestionsWaterfall","PhotosTaggingFlyoutLoader","BanzaiODS","FaceRecognitionController","ComposerXNUX","DOM","CSS","cx","csx","DOMQuery","isEmpty","fbt","Tooltip","Parent","Form","SubscriptionsHandler","PhotosUploadWaterfallXMixin","AsyncRequest","getObjectValues"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba){b.__markCompiled&&b.__markCompiled();var ca=[];e.exports=Object.assign(z,{initTaggingFlyoutMixin:function(da,ea){this._attachment=da;this._taggingFlyoutData={};this._taggingFlyoutData.root=da.getRoot();this._taggingFlyoutData.gridID=da.getGridID();this._taggingFlyoutData.uploadArea=da.getUploadArea();this._taggingFlyoutData.submitButton=da.getSubmitButton();this._taggingFlyoutData.tagger=da.getTagger();this._taggingFlyoutData.config=ea;this._taggingFlyoutData.xyTagInputs={};this._taggingFlyoutData.subscriptions=new y();this._initTaggingFlyout();},setFaceRecSubmitButtonLock:function(da){this._taggingFlyoutData.faceRecSubmitButtonLock=da;},initTaggingFlyoutWithComponents:function(){this._taggingFlyoutData.scrollableArea=this._attachment.getScrollableArea();this._taggingFlyoutData.subscriptions.addSubscriptions(h.subscribe('multi-upload/image-removed/'+this._taggingFlyoutData.gridID,this._doHandleImageRemoved.bind(this)),h.subscribe('multi-upload/images-added/'+this._taggingFlyoutData.gridID,this._doHandleImageAdded.bind(this)),this._taggingFlyoutData.recognitionController.subscribe('recognition',this._doHandleRecognitionResult.bind(this)),this._taggingFlyoutData.recognitionController.subscribe('photo',this._doHandlePhotoRecognitionDone.bind(this)),this._taggingFlyoutData.recognitionController.subscribe('done',function(fa,ga){this._taggingFlyoutData.faceRecSubmitButtonLock.unlock();this._setSubmitButtonTooltip('');ga.unresolved.forEach(function(ha){this._taggingFlyoutData.flyoutLoader.whenLoaded(ha,function(ia){ia.reset();});this._taggingFlyoutData.facerecLogger.bump('facerec_queries_fail');this._taggingFlyoutData.tagSuggestionsWaterfall.logFailure(ha,ga.user);this._doHandlePhotoRecognitionDone(fa,{photo:ha,faceboxes:[],recognitions:0});},this);this._taggingFlyoutData.facerecLogger.bump('facerec_queries_done');this._taggingFlyoutData.tagSuggestionsWaterfall.logStopPoll(Date.now()-this._taggingFlyoutData.pollLastStartedTimestamp,ga.unresolved.length);}.bind(this)));var da=this.getComponentInstance('withtagger');if(da)this._taggingFlyoutData.subscriptions.addSubscriptions(da.subscribe('removeToken',this._doHandleTokenRemoved.bind(this)));i.getInstance().clear();var ea=this.getWaterfallID();this._taggingFlyoutData.tagSuggestionsWaterfall=new j(ea);this._taggingFlyoutData.tagSuggestionsWaterfall.logBegin();this._taggingFlyoutData.flowBeginTimestamp=Date.now();this._taggingFlyoutData.recognitionController.setWaterfallID(ea);},cleanupTaggingFlyout:function(){this._taggingFlyoutData.flyoutLoader.cleanup();if(this._taggingFlyoutData.config.taggingFlyoutNUXDialog)n.onCleanup(this._taggingFlyoutData.config.taggingFlyoutNUXDialog);this.releaseSubscriptions();this.engageSubscriptions();},resetTaggingFlyout:function(){i.getInstance().clear();if(this._taggingFlyoutData){this._taggingFlyoutData.recognitionController.stop();for(var da in this._taggingFlyoutData.xyTagInputs)o.remove(this._taggingFlyoutData.xyTagInputs[da]);this._taggingFlyoutData.xyTagInputs={};}},getWaterfallID:function(){throw "Classes using AttachmentWithPhotosTaggingFlyoutMixin "+"should implement getWaterfallID";},releaseSubscriptions:function(){this._taggingFlyoutData.subscriptions.release();},engageSubscriptions:function(){this._taggingFlyoutData.subscriptions.engage();},addSubscriptions:function(){for(var da=[],ea=0,fa=arguments.length;ea<fa;ea++)da.push(arguments[ea]);var ga=this._taggingFlyoutData.subscriptions;ga.addSubscriptions.apply(ga,da);},getSubscriptions:function(da){return this._taggingFlyoutData.subscriptions;},logWithTaggingData:function(da,ea){var fa=0,ga=this.getComponentInstance('withtagger');if(ga){var ha=i.getInstance(),ia=ga.getTokens();fa=ia.filter(function(la){return !ha.userHasDirtyTags(la.info.uid);}).length;var ja=ha.getAllTags(),ka=ja.filter(function(la){return la.source=='composerx_suggestions';});this._taggingFlyoutData.tagSuggestionsWaterfall.logSubmit(da,ia.length,fa,ka.length,ja.length-ka.length,Date.now()-this._taggingFlyoutData.flowBeginTimestamp);}return fa;},_initTaggingFlyout:function(){this._taggingFlyoutData.flyoutLoader=new k(this._taggingFlyoutData.config.targetID);this._taggingFlyoutData.flyoutLoader.subscribe('loaded',function(da,ea){this._setupTaggingFlyout(ea);}.bind(this));this._taggingFlyoutData.facerecLogger={bump:function(da,ea){l.bumpEntityKey('composer_facerec_suggestions',da,ea);}};this._taggingFlyoutData.recognitionController=new m({targetID:this._taggingFlyoutData.config.targetID,targetIsPage:this._taggingFlyoutData.config.targetIsPage});},_setupTaggingFlyout:function(da){ca.push(da);if(!this._getPhotoGridItem(da.getPhotoID()))return;this._taggingFlyoutData.subscriptions.addSubscriptions(da.subscribe('show',this._onTaggingFlyoutShow.bind(this,da)),da.subscribe('beforehide',this._onTaggingFlyoutHide.bind(this,da)),da.subscribe('confirm',this._onTaggingFlyoutConfirmed.bind(this,da)),da.subscribe('select',this._onTaggingFlyoutSelect.bind(this,da)),da.subscribe('unselect',this._onTaggingFlyoutUnselect.bind(this,da)));},_onTaggingFlyoutShow:function(da,ea,fa){ca.forEach(function(ga){if(ga!=da)ga.hide();});if(this._taggingFlyoutData.config.taggingFlyoutNUXDialog)n.acknowledgeDialog(n.TAGGING_FLYOUT_NUX,this._taggingFlyoutData.config.taggingFlyoutNUXDialog);da.setNextButtonVisibility(!this._findNextTaggableGridItem(this._getPhotoGridItem(da.getPhotoID())));},_onTaggingFlyoutHide:function(da,ea,fa){p.removeClass(da.getContext(),"_58pl");p.conditionClass(this._taggingFlyoutData.uploadArea,"_58pk",s.scry(this._taggingFlyoutData.uploadArea,"._58pl").length);},_onTaggingFlyoutConfirmed:function(da,ea,fa){var ga=this._findNextTaggableGridItem(this._getPhotoGridItem(da.getPhotoID()));if(!ga)return;if(this._taggingFlyoutData.scrollableArea)this._taggingFlyoutData.scrollableArea.scrollIntoView(ga);p.addClass(this._taggingFlyoutData.uploadArea,"_58pk");p.addClass(ga,"_58pl");this._getTaggingFlyout(ga.getAttribute('data-fbid'),function(ha){ha.show(ga);});},_onTaggingFlyoutSelect:function(da,ea,fa){p.addClass(this._getPhotoGridItem(da.getPhotoID()),"_57vj");var ga=i.getInstance().userHasDirtyTags(fa.user);if(!ga)this._taggingFlyoutData.facerecLogger.bump('suggestion_tags_added');i.getInstance().storeTagWithOptions(fa.photo,fa.user,fa.facebox.x,fa.facebox.y,{fbid:fa.photo,name:fa.name,subject:fa.user,from_facebox:true,facebox:fa.facebox.fbid,source:'composerx_flyout'});this._taggingFlyoutData.tagSuggestionsWaterfall.logAddManualTag(fa.photo,fa.facebox.fbid,fa.user);var ha=this.getComponentInstance('withtagger');if(ha)if(!ga){var ia=ha.replaceToken(ha.createDecorativeToken({uid:fa.user,text:fa.name},'faceSuggestion'));this._taggingFlyoutData.tagSuggestionsWaterfall.logAddToken(fa.user,ia);}this._updateXYTagInputs();},_onTaggingFlyoutUnselect:function(da,ea,fa){this._fireDismissRequest([{facebox:fa.facebox,log_data:{tagee:fa.user,is_first:true}}]);var ga=i.getInstance().removeTag(fa.photo,fa.user);if(t(ga))return;var ha=this._taggingFlyoutData.tagSuggestionsWaterfall;ga.forEach(function(ka){if(ka.source=='composerx_suggestions'){ha.logRemoveSuggestion(ka.fbid,ka.facebox,ka.subject,ka.certainty);}else ha.logRemoveManualTag(ka.fbid,ka.facebox,ka.subject);});p.conditionClass(this._getPhotoGridItem(da.getPhotoID()),"_57vj",!t(i.getInstance().getPhotoTags(fa.photo)));var ia=i.getInstance().userHasDirtyTags(fa.user),ja=this.getComponentInstance('withtagger');if(ja&&!ia){ja.removeToken(ja.findToken({uid:fa.user}));this._taggingFlyoutData.tagSuggestionsWaterfall.logRemoveToken(fa.user,0);}this._updateXYTagInputs();},_doHandleImageRemoved:function(da,ea){this._taggingFlyoutData.flyoutLoader.remove(ea);var fa=0,ga=[],ha=this.getComponentInstance('withtagger');if(ha){ga=Object.keys(i.getInstance().getPhotoTags(ea));i.getInstance().removeAllTagsFromPhoto(ea);ga.forEach(function(ia){if(!i.getInstance().userHasDirtyTags(ia)){fa++;ha.removeToken(ha.findToken({uid:ia}));}});}this._taggingFlyoutData.tagSuggestionsWaterfall.logRemovePhoto(ea,fa,ga.length);this._updateXYTagInputs();ca.forEach(function(ia){return ia.hide();});},_doHandleImageAdded:function(da,ea){if(ea.disableRecognition)return;Object.keys(ea.fbids).forEach(function(fa){var ga=ea.fbids[fa],ha=this._getPhotoGridItem(ga);if(ha)p.addClass(ha,"_57vh");},this);this._taggingFlyoutData.tagSuggestionsWaterfall.logAddPhotos(ba(ea.fbids));this._taggingFlyoutData.facerecLogger.bump('photos_queried');if(this.getComponent('withtagger')&&!this._taggingFlyoutData.config.hideWithTagger)this._taggingFlyoutData.tagger.eventuallySwitchToTagger('with');if(!this._taggingFlyoutData.config.applyTagSuggestionsDelay)this._taggingFlyoutData.faceRecSubmitButtonLock.lock();this._taggingFlyoutData.recognitionController.start(ba(ea.fbids));this._setSubmitButtonTooltip(u._("Processing"));this._taggingFlyoutData.pollLastStartedTimestamp=Date.now();this._taggingFlyoutData.tagSuggestionsWaterfall.logStartPoll(Object.keys(ea.fbids).length);},_doHandleRecognitionResult:function(da,ea){var fa=ea.facebox,ga=ea.recognition,ha=i.getInstance().userHasDirtyTags(ga.user.fbid);this._taggingFlyoutData.facerecLogger.bump('xy_tags_added');this._taggingFlyoutData.tagSuggestionsWaterfall.logAddSuggestion(ea.photo,fa.fbid,ga.user.fbid,ga.certainty);if(!ha)this._taggingFlyoutData.facerecLogger.bump('suggestion_tags_added');i.getInstance().storeTagWithOptions(ea.photo,ga.user.fbid,fa.x,fa.y,{fbid:ea.photo,name:ga.user.name,subject:ga.user.fbid,from_facebox:true,facebox:fa.fbid,certainty:ga.certainty,source:'composerx_suggestions',timestamp:Date.now()});var ia=this.getComponentInstance('withtagger');if(ia){if(!ha){var ja=ia.replaceToken(ia.createDecorativeToken({uid:ga.user.fbid,text:ga.user.name},this._taggingFlyoutData.config.additionalTokensGlyph));this._taggingFlyoutData.tagSuggestionsWaterfall.logAddToken(ga.user.fbid,ja);}this._taggingFlyoutData.tagger.eventuallySwitchToTagger('with');}setTimeout(this._updateXYTagInputs.bind(this),this._taggingFlyoutData.config.applyTagSuggestionsDelay?500:0);},_doHandlePhotoRecognitionDone:function(da,ea){var fa=ea.photo,ga=this._getPhotoGridItem(fa);if(!ga)return;p.removeClass(ga,"_57vh");if(!this._taggingFlyoutData.config.useTaggingFlyout)return;p.addClass(ga,"_57vi");p.conditionClass(ga,"_57vj",ea.recognitions);p.conditionClass(ga,"_57vk",ea.faceboxes.length);if(ea.recognitions&&this._taggingFlyoutData.config.taggingFlyoutNUXDialog&&!this._taggingFlyoutData.taggingFlyoutNUXShown){this._scrollIntoView(ga);n.onInit(this._taggingFlyoutData.config.taggingFlyoutNUXDialog,ga,n.TAGGING_FLYOUT_NUX);this._taggingFlyoutData.taggingFlyoutNUXShown=true;}this._taggingFlyoutData.subscriptions.addSubscriptions(g.listen(ga,'click',function(ha){if(p.hasClass(ha.target,'fbVaultGridPhotoItemRemoveButton')||p.hasClass(ha.target,'fbVaultGridPhotoItemEditButton')||p.hasClass(ha.target,"_24iq"))return;p.addClass(this._taggingFlyoutData.uploadArea,"_58pk");p.addClass(ga,"_58pl");this._getTaggingFlyout(fa,function(ia){ia.toggle(ga);});}.bind(this)));},_setSubmitButtonTooltip:function(da){var ea=s.find(this._taggingFlyoutData.root,"._yo");if(da){v.set(ea,da,'above','center');}else{v.remove(ea);ea.setAttribute('aria-label',u._("Post"));}},_doHandleTokenRemoved:function(da,ea){var fa=i.getInstance(),ga=ea.info.uid,ha=this._taggingFlyoutData;if(fa.userHasDirtyTags(ga)){var ia=fa.userDirtyTagsCount(ga);ha.tagSuggestionsWaterfall.logRemoveToken(ga,ia);ha.facerecLogger.bump('suggestion_tokens_removed');ha.facerecLogger.bump('xy_tags_removed',ia);}var ja=[];fa.removeAllNewTagsOfUser(ga).forEach(function(ka){ja.push({facebox:ka.facebox,log_data:{tagee:ka.subject,is_first:true}});if(ha.config.useTaggingFlyout){if(!fa.photoHasTags(ka.fbid))p.removeClass(this._getPhotoGridItem(ka.fbid),"_57vj");ha.flyoutLoader.whenLoaded(ka.fbid,function(la){la.getFaceboxInstance(ka.facebox).reset();});}if(ka.source=='composerx_suggestions'){ha.tagSuggestionsWaterfall.logRemoveSuggestion(ka.fbid,ka.facebox,ka.subject,ka.certainty);}else ha.tagSuggestionsWaterfall.logRemoveManualTag(ka.fbid,ka.facebox,ka.subject);}.bind(this));this._fireDismissRequest(ja);this._updateXYTagInputs();},_updateXYTagInputs:function(){var da=w.byTag(this._taggingFlyoutData.submitButton,'form');for(var ea in this._taggingFlyoutData.xyTagInputs)o.remove(this._taggingFlyoutData.xyTagInputs[ea]);var fa=i.getInstance().getAllTags();if(this._taggingFlyoutData.config.applyTagSuggestionsDelay)fa=fa.filter(function(ga){return !ga.timestamp||(ga.timestamp+500<=Date.now());});x.createHiddenInputs({xy_tags:fa},da,this._taggingFlyoutData.xyTagInputs);},_getPhotoGridItem:function(da){return s.scry(this._taggingFlyoutData.uploadArea,'.fbVaultGridItem[data-fbid="'+da+'"]')[0];},_findNextTaggableGridItem:function(da){var ea=s.scry(this._taggingFlyoutData.uploadArea,'.fbVaultGridItem'),fa=ea.indexOf(da);while(++fa<ea.length)if(p.hasClass(ea[fa],"_57vk"))break;return ea[fa];},_getTaggingFlyout:function(da,ea){this._taggingFlyoutData.flyoutLoader.get(da,ea);},_fireDismissRequest:function(da){if(da.length>0)new aa().setURI('/ajax/dismiss_tag_suggest.php').setMethod('POST').setData({facebox_logs:da,closing_source:'composerx_suggestions',closing_action:'no'}).setAllowCrossPageTransition(true).send();},_scrollIntoView:function(da){if(this._taggingFlyoutData.scrollableArea)this._taggingFlyoutData.scrollableArea.scrollIntoView(da);}});},null);
__d("ComposerXPrivacyWidgetTags",["Arbiter","CurrentUser","PrivacySelectorBase","getObjectValues"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();function k(l){"use strict";var m=l.getComponent('mainprivacywidget');if(!m){this._subscriptions=[];return null;}this._privacyWidget=m.element;this._privacyWidgetInstance=m.instance&&m.instance.getInstance().getInstance();this._mentionsInput=l.getComponent('maininput').instance;this._placeTypeahead=l.getComponent('placetagger')?l.getComponent('placetagger').instance:null;this._friendsTokenizer=l.getComponent('withtagger')?l.getComponent('withtagger').instance:null;this._ogTagger=l.getComponent('ogtagger')?l.getComponent('ogtagger').instance:null;this._init();}k.prototype._init=function(){"use strict";this._subscriptions=[this._mentionsInput.subscribe('update',this._informChangedTags.bind(this))];if(this._placeTypeahead){this._subscriptions.push(this._placeTypeahead.subscribe('select',this._onPlaceSelect.bind(this)));this._subscriptions.push(g.subscribe('Events/autoSuggestionSelected',this._onPlaceSelect.bind(this)));this._subscriptions.push(this._placeTypeahead.subscribe('unselect',this._onPlaceUnselect.bind(this)));}if(this._ogTagger)this._subscriptions.push(this._ogTagger.subscribe('composer/eventExpansionChanged',this._informChangedEventExpansion.bind(this)));if(this._friendsTokenizer)this._subscriptions.push(this._friendsTokenizer.subscribe(['addToken','removeToken'],this._informChangedTags.bind(this)));this._informChangedTags();};k.prototype._getTaggedNamesForAudience=function(){"use strict";var l={},m=this._mentionsInput.getMentions();for(var n in m)if(m[n].type=='user')l[n]=m[n].text;if(this._friendsTokenizer)this._friendsTokenizer.getTokens().map(function(o){l[o.getValue()]=o.getText();});delete l[h.getID()];return j(l);};k.prototype._onPlaceSelect=function(l,m){"use strict";this._placeType=m.selected.place_type;this._informChangedTags();};k.prototype._onPlaceUnselect=function(l,m){"use strict";this._placeType=null;this._informChangedTags();};k.prototype._informChangedEventExpansion=function(){"use strict";if(this._privacyWidgetInstance instanceof i)this._privacyWidgetInstance.informEventExpansionChanged(this._ogTagger.getEventExpansionType());};k.prototype._informChangedTags=function(){"use strict";var l=[];if(this._friendsTokenizer)l=this._friendsTokenizer.getTokens();var m=null;if(this._placeType==='Event')m=this._placeTypeahead.getCore().getHiddenValue();var n={withTags:l,mention:this._mentionsInput.getMentions(),eventTag:m};g.inform('Composer/changedtags',n);if(this._privacyWidgetInstance&&this._privacyWidgetInstance instanceof i)this._privacyWidgetInstance.informTagsChanged(n);};k.prototype.destroy=function(){"use strict";while(this._subscriptions.length)this._subscriptions.pop().unsubscribe();};Object.assign(k.prototype,{_subscriptions:null,_placeType:null});e.exports=k;},null);
__d("ComposerXMediaUploadAttachment",["Arbiter","Button","ComposerXAttachment","ComposerXAttachmentUtils","ComposerXAttachmentButtonBarState","ComposerXAttachmentPrefillMixin","ComposerXPrivacyWidgetTags","ComposerXSessionIDInserter","Dialog","DOM","DOMQuery","Event","PagesEventObserver","PagesComposerEntryLogger","Parent","SubscriptionsHandler","classWithMixins","csx","cx","ge","fbt","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba){b.__markCompiled&&b.__markCompiled();var ca=w(i,ba(l));for(var da in ca)if(ca.hasOwnProperty(da))fa[da]=ca[da];var ea=ca===null?null:ca.prototype;fa.prototype=Object.create(ea);fa.prototype.constructor=fa;fa.__superConstructor__=ca;function fa(ga,ha,ia){"use strict";ca.call(this);this._root=ga;this._tagger=ha;this._config=ia;this._hasSelected=false;this._subscriptions=new v();this._submitButton=p.find(this._root,"._yo");}fa.prototype.getRoot=function(){"use strict";return this._root;};fa.prototype.getUploadArea=function(){"use strict";return this._uploadArea;};fa.prototype.getSubmitButton=function(){"use strict";return this._submitButton;};fa.prototype.getTagger=function(){"use strict";return this._tagger;};fa.prototype.initWithComponents=function(){"use strict";this._uploadArea=p.find(this._root,"div._yn");this._initFileInput();var ga=this.getComponent('maininput');j.initMentions(ga,this._config.mentionsPlaceholder,this.getComposerID(),{dontFocusMentions:this._config.dontFocusMentions});var ha=q.find(ga.element,'textarea.input');if(!ha.value&&this._config.targetIsPage){this._pagesComposerEntryLogger=new t(this._config.targetID);this._pagesComposerEntryLogger.registerForContentEntryEvents(ha);}if(this._config.prefill)this._initPrefill(q.find(this.getComponent('maininput').element,'textarea.input'),this._config.prefill);this._root.action=this._config.photoEndpoint;this._tagger.init(this);this._privacyWidgetTags=new m(this);k.trackCityChanges(this);g.inform('ComposerXMediaUpload/start');var ia=this._config.fileForm;this._subscriptions.addSubscriptions(ia.subscribe('submit',function(){n.insertSessionInput(ia.getRoot());}.bind(this)));if(this._config.postActionsButton!=null)this._config.postActionsButton.initHiddenInputs(this.getComponent('pabhiddeninputs').instance);g.inform('composer/render_pab_nux');};fa.prototype.persistUploadArea=function(){"use strict";return false;};fa.prototype.cleanup=function(){"use strict";this._tagger.cleanup();this._privacyWidgetTags&&this._privacyWidgetTags.destroy();this._privacyWidgetTags=null;this._subscriptions.release();this._subscriptions.engage();if(this._pagesComposerEntryLogger)this._pagesComposerEntryLogger.unregister();};fa.prototype.reset=function(){"use strict";this._tagger.reset();this._resetFileInput();if(this._config.prefill)this._resetPrefill();};fa.prototype._resetFileInput=function(){"use strict";p.replace(this._fileInput,this._fileInputCopy);this._initFileInput();};fa.prototype.canSwitchAway=function(){"use strict";return !u.byClass(this._root,'async_saving');};fa.prototype._setSubmitButtonEnabled=function(ga){"use strict";h.setEnabled(this._submitButton,ga);};fa.prototype._isImageFile=function(){"use strict";return !!this._config.imageExtensions[this._getFileExtension()];};fa.prototype._getFileExtension=function(){"use strict";return this._fileInput.value.split('.').pop().toLowerCase();};fa.prototype._initFileInput=function(){"use strict";this._fileInput=p.find(this._root,"._n");this._fileInputCopy=this._fileInput.cloneNode(false);this._subscriptions.addSubscriptions(r.listen(this._fileInput,'change',this._onFileChange.bind(this)));};fa.prototype._onFileChange=function(){"use strict";if(this._isImagesOnly()&&!this._isImageFile()){new o().setTitle(aa._("Invalid Image File")).setBody(aa._("Please upload a valid image file.")).setModal(true).setButtons([o.OK]).show();this._resetFileInput();}else{p.setContent(z('fbComposerUploadMediaFilename'),this._fileInput.value.split('\\').pop());this._setSubmitButtonEnabled(!!this._fileInput.value);}var ga=this._getPageSelectLoggingData();if(ga&&!this._hasSelected&&this._fileInput.value){this._hasSelected=true;s.logData_DEPRECATED(ga,null);}};fa.prototype._isImagesOnly=function(){"use strict";return !!this._config.imagesOnly;};fa.prototype._getPageSelectLoggingData=function(){"use strict";return this._config.pageSelectLoggingData;};Object.assign(fa.prototype,{_privacyWidgetTags:null,attachmentClassName:"_92"});e.exports=fa;},null);
__d("Lockable",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(i,j){"use strict";this._onUnlock=i;this._onLock=j;this._isLocked=false;this._locks=[];}g.prototype.getLock=function(){"use strict";var i=new h(this._onLockChanged.bind(this));this._locks.push(i);return i;};g.prototype._onLockChanged=function(){"use strict";var i=this._locks.some(function(j){return j.isLocked();});if(i!==this._isLocked){this._isLocked=i;if(i){this._onLock();}else this._onUnlock();}};function h(i){"use strict";this._isLocked=false;this._onChange=i;}h.prototype.lock=function(){"use strict";if(!this._isLocked){this._isLocked=true;this._onChange();}return this;};h.prototype.unlock=function(){"use strict";if(this._isLocked){this._isLocked=false;this._onChange();}return this;};h.prototype.isLocked=function(){"use strict";return this._isLocked;};e.exports=g;},null);
__d("XComposerXAddPhotoItemController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/composerx\/photo\/item\/",{photo_fbid:{type:"Int",required:true},grid_id:{type:"String",required:true},image_height:{type:"Int",required:true},image_width:{type:"Int",required:true}});},null);
__d("ComposerXMediaUploadPlusAttachment",["Event","Arbiter","ComposerXAttachmentUtils","ComposerXController","ComposerXDragDrop","ComposerXDragDropUtils","ComposerXMediaUploadAttachment","CSS","DOM","Lockable","Parent","PhotoEditorSaveStates","PhotosMultiUploadInput","PUWApplications","AsyncRequest","csx","cx","ge","mixin","classWithMixins","AttachmentWithPhotoEditorTaggingMixin","AttachmentWithPhotosTaggingFlyoutMixin","PUWSteps","Scroll","SubscriptionsHandler","XComposerXAddPhotoItemController"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa){b.__markCompiled&&b.__markCompiled();var ga=z(m,y(ba,aa));for(var ha in ga)if(ga.hasOwnProperty(ha))ja[ha]=ga[ha];var ia=ga===null?null:ga.prototype;ja.prototype=Object.create(ia);ja.prototype.constructor=ja;ja.__superConstructor__=ga;function ja(ka,la,ma){"use strict";ga.call(this,ka,la,ma);this._cameraIcon=null;this._eventSuggestionQuerySent=false;this._submitButtonLockable=null;this._cleaningUp=false;this._resetting=false;if(this._config.warningDialog)this._config.warningDialog.setContext(this._submitButton);this._photosToInit=this._config.existingPhotos;if(this._config.qualityChooser)this._config.qualityChooser.addListener('checkboxChanged',function(na){this.getScrollableArea().getUploadItem().getUploadInput().onQualitySettingChanged(na);new u().setURI('/ajax/photos/upload/settings/').setData({composer_resolution:na?'high':'standard'}).send();}.bind(this));}ja.prototype.getPhotoCount=function(){"use strict";return this.getScrollableArea().getPhotoCount();};ja.prototype.getGrid=function(){"use strict";return this._grid;};ja.prototype.getGridID=function(){"use strict";return this._gridID;};ja.prototype.getWaterfallID=function(){"use strict";if(this._grid){return this._grid.getWaterfallID();}else return s.getWaterfallID(this._gridID);};ja.prototype.getWaterfallAppName=function(){"use strict";return t.WEB_COMPOSER;};ja.prototype.getScrollableArea=function(){"use strict";return this.getComponent('upload_area').instance;};ja.prototype.initWithComponents=function(){"use strict";ia.initWithComponents.call(this);this._gridID=this._uploadArea.id;var ka=this.getScrollableArea().getUploadItem(),la=this._config.usePhotoEditorTagging;if(ka&&ka.getUploadInput().getGrid)this._grid=ka.getUploadInput().getGrid();if(la){this.initPhotoEditorTaggingMixin();}else this.initTaggingFlyoutMixin(this,this._config);this.addSubscriptions(h.subscribe('multi-upload/images-upload-start/'+this._gridID,this._onUploadStart.bind(this)),h.subscribe('multi-upload/composer-reset/'+this._gridID,this._handleMultiUploadComposerReset.bind(this)),h.subscribe('multi-upload/images-added/'+this._gridID,this._handleImageAdded.bind(this)),h.subscribe('multi-upload/image-removed/'+this._gridID,this._handleImageRemoved.bind(this)),g.listen(this._root,'submit',this._onSubmit.bind(this),g.Priority.URGENT));if(this.supportsDragDrop()&&!this._dragdrop)this._dragdrop=new k(this._root,this.getComposerID());if(!la)this.initTaggingFlyoutWithComponents();this._cameraIcon=this.getComponent('cameraicon');this._moreLink=o.find(this._root,"._2oh");n.conditionShow(this._moreLink,this._config.isMediaModifiable);var ma=[this._moreLink];this._cameraIcon&&ma.push(this._cameraIcon.element);this.getScrollableArea().initialize(ma,this._config,this._root,this._gridID,this.getComposerID());this.getScrollableArea().setPlaceholderHandler(this._setPlaceholders.bind(this));this._resetSubmitButtonLockable();var na;if(!this._config.allowNoMedia){na=this._submitButtonLockable.getLock().lock();this.getScrollableArea().setEnableComposerHandler(function(oa){if(oa){h.inform('ComposerXMediaUploadPlusAttachment/submitEnabled');na.unlock();}else{h.inform('ComposerXMediaUploadPlusAttachment/submitDisabled');na.lock();}}).setAllMediaRemovedHandler(function(){if(!this._cleaningUp&&!this._resetting)if(j.hasAttachmentWithClassName(this._root,"_4j")){j.getAttachment(this._root,'/ajax/composerx/attachment/status/');}else if(this._config.editPostID)j.getAttachment(this._root,this._config.statusAttachmentEndpoint);}.bind(this));}else{na=this._submitButtonLockable.getLock().unlock();this.getScrollableArea().setEnableComposerHandler(function(oa){h.inform('ComposerXMediaUploadPlusAttachment/submitEnabled');na.unlock();});}if(!this._fileHandler)this._fileHandler=h.subscribe('ComposerXFilesStore/filesAdded/'+this._composerID+'/mediaupload',function(oa,pa){if(!pa.fileInput.getValue()||pa.receivedBySubscriber)return;pa.receivedBySubscriber=true;if(this._grid){this._grid.doFileUpload(pa.fileInput);}else s.doFileUpload(this._gridID,pa.fileInput);}.bind(this));if(!this._cameraPhotoHandler)this._cameraPhotoHandler=h.subscribe('ComposerXFilesStore/filesAdded/'+this._composerID+'/cameraphoto',function(oa,pa){var qa=fa.getURIBuilder().setInt('photo_fbid',pa.photoFBID).setString('grid_id',this._gridID).setInt('image_width',this._config.thumbnailSize.width).setInt('image_height',this._config.thumbnailSize.height).getURI();new u(qa).send();}.bind(this));if(this.supportsDragDrop()&&!this._dragdropHandler){this._dragdropHandler=h.subscribe('ComposerXFilesStore/filesDropped/'+this._composerID+'/mediaupload',function(oa,pa){if(this._grid){this._grid.onFilesDrop(pa.files,pa.method);}else s.onFilesDrop(this._gridID,pa.files);}.bind(this));l.handleDragEnterAndLeave(this._root);}if(this._photosToInit){this._photosToInit.forEach(function(oa){h.inform(['multi-upload/images-added/'+this._gridID,'multi-upload/images-added'],{fbids:{'0':''+oa},tagInfo:{},disableRecognition:true,initialPhoto:true});}.bind(this));this._photosToInit=null;}n.conditionShow(this.getScrollableArea().getUploadArea().getRoot(),this._config.isMediaModifiable||this.getPhotoCount()>0);if(this._config.postActionsButton!=null)this._config.postActionsButton.initHiddenInputs(this.getComponent('pabhiddeninputs').instance);};ja.prototype.reset=function(){"use strict";this._resetting=true;if(this._config.usePhotoEditorTagging){this.resetPhotoEditorTagging();}else this.resetTaggingFlyout();this.getTagger().reset();this._eventSuggestionQuerySent=false;if(this._config.isAutoEventSuggestionEnabled){var ka=x('event_tagging_auto_suggestion');ka&&n.hide(ka);}this._resetting=false;if(this._config.prefill)this._resetPrefill();};ja.prototype._handleImageAdded=function(ka,la){"use strict";this.getScrollableArea().handleImageAdded(ka,la);this._checkPhotoMaxSelect();if(this._config.preShowWithTagger&&this.getComponent('withtagger'))this.getTagger().eventuallySwitchToTagger('with');if(la.tagInfo.exifLocation&&la.tagInfo.exifLocation.rank_place_tagger&&la.tagInfo.exifLocation.latitude&&la.tagInfo.exifLocation.longitude){var ma=this.getComponent('placetagger');if(ma&&ma.instance){ma.instance.getCore().setLocation(la.tagInfo.exifLocation);if(la.tagInfo.exifLocation.flow_to_place_tagger)this.getTagger().eventuallySwitchToTagger('place');}}if(!this._config.isAutoEventSuggestionEnabled)return;if(this.getComponent('hiddenplaceinput').element.value)return;if(this._eventSuggestionQuerySent)return;this._sendEventsSuggestionRequest({fbid:la.fbids[Object.keys(la.fbids)[0]],anchor_id:'composerCityTagger'});this._eventSuggestionQuerySent=true;};ja.prototype._handleImageRemoved=function(ka,la){"use strict";this.getScrollableArea().handleImageRemoved(ka,la);this._checkPhotoMaxSelect();};ja.prototype._handleMultiUploadComposerReset=function(){"use strict";this._resetting=true;this.getScrollableArea().reset();this._resetting=false;};ja.prototype.cleanup=function(){"use strict";this._cleaningUp=true;if(this._config.usePhotoEditorTagging){this.cleanupPhotoEditorTagging();}else this.cleanupTaggingFlyout();ia.cleanup.call(this);if(!this.persistUploadArea())this.getScrollableArea().cleanup();this._moreLinkListener&&this._moreLinkListener.remove();if(this.getComponent('withtagger'))this._withTaggerIconListener&&this._withTaggerIconListener.remove();if(this._fileHandler){this._fileHandler.unsubscribe();this._fileHandler=null;}if(this._dragdrop){this._dragdrop.deactivate();this._dragdrop=null;}this._cleaningUp=false;};ja.prototype.canSwitchAway=function(){"use strict";return !q.byClass(this._root,'async_saving');};ja.prototype.supportsDragDrop=function(){"use strict";return this._config.maxSelect!==1;};ja.prototype._setPlaceholders=function(ka,la){"use strict";i.setStickyPlaceholderForMentions(this.getComponent('maininput'),ka);i.setStickyPlaceholderForTypeahead(this.getComponent('placetagger').element,la);this._cameraIcon&&n.conditionClass(this._cameraIcon.element,"_1dsx",this.getScrollableArea().getTotalImageCount()>0);};ja.prototype._resetSubmitButtonLockable=function(){"use strict";this._submitButtonLockable=new p(this._setSubmitButtonEnabled.bind(this,true),this._setSubmitButtonEnabled.bind(this,false));this._overImageSelectionLimitLock=this._submitButtonLockable.getLock();this.setFaceRecSubmitButtonLock(this._submitButtonLockable.getLock());};ja.prototype._onUploadStart=function(){"use strict";var ka=o.find(this._root,'.fbScrollableAreaWrap');da.setLeft(ka,Math.max(0,o.find(this._root,'.fbScrollableAreaBody').offsetWidth-ka.offsetWidth));};ja.prototype._sendEventsSuggestionRequest=function(ka){"use strict";new u('ajax/events/tagging/suggestion_query').setData(ka).setHandler(null).send();};ja.prototype._initFileInput=function(){"use strict";};ja.prototype._getTotalNumberOfStickersOnPhotos=function(){"use strict";var ka=o.scry(this._root,".fbVaultGridItem"),la=0;ka.forEach(function(ma){la+=r.getTotalNumOfStickersOnPhoto(ma.getAttribute('data-originalfbid'));});return la;};ja.prototype._onSubmit=function(){"use strict";var ka=Date.now(),la=this.logWithTaggingData(this.getPhotoCount(),this.getComposerID()),ma={volume:this.getPhotoCount(),with_tag_count:la,sticker_count:this._getTotalNumberOfStickersOnPhotos()};this.logStep(ca.CLIENT_PUBLISH_BEGIN,ma);var na=new ea();na.addSubscriptions(g.listen(this._root,'success',function(oa){ma.dt=Date.now()-ka;this.logStep(ca.CLIENT_PUBLISH_SUCCESS,ma);this.logStep(ca.CLIENT_FLOW_SUCCESS);na.release();}.bind(this)),g.listen(this._root,'error',function(oa){ma.dt=Date.now()-ka;oa=oa.getData().response;if(oa){ma.error_code=oa.getError();ma.error_info=oa.getErrorDescription();}this.logStep(ca.CLIENT_PUBLISH_FAIL,ma);na.release();}.bind(this)));};ja.prototype._checkPhotoMaxSelect=function(){"use strict";if(this._config.maxSelect>1)if(this.getPhotoCount()>this._config.maxSelect){this._config.warningDialog.show();if(this._overImageSelectionLimitLock)this._overImageSelectionLimitLock.lock();}else{this._config.warningDialog.hide();if(this._overImageSelectionLimitLock)this._overImageSelectionLimitLock.unlock();}};e.exports=ja;},null);
__d("GroupSellComposerLogger",["BanzaiLogger","GroupSellComposerActionEvents"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={log:function(j,event,k){g.log('GroupSellComposerActionsLoggerConfig',{event:event,group_id:j,is_edit:k});},logComposerSubmit:function(j,k,l,m,n,o,p,q,r){g.log('GroupSellComposerActionsLoggerConfig',{event:h.COMPOSER_SUBMIT,group_id:j,title:k,price_currency:l,price_amount:m,description:n,pickup_note:o,num_photos:p,is_edit:q,is_intercept:r});},logComposerNonForsaleSubmit:function(j,k,l){g.log('GroupSellComposerActionsLoggerConfig',{event:h.COMPOSER_SUBMIT_REGULAR,group_id:j,description:k,is_edit:l});},logVideoEvent:function(event,j){g.log('GroupSellComposerActionsLoggerConfig',{event:event,video_time_position:j});}};e.exports=i;},null);
__d("XGroupSellNUXPostToMarketplaceDialogController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/ajax\/groups\/sell\/post_to_marketplace\/",{root_id:{type:"String"},button_id:{type:"String"},checkbox_id:{type:"String"},group_id:{type:"String"},__asyncDialog:{type:"Int"}});},null);
__d("ComposerXSellAttachmentMixin",["Arbiter","ComposerXController","CSS","DataStore","DOM","Focus","Input","Event","GroupSellComposerActionEvents","GroupSellComposerLogger","Parent","SubscriptionsHandler","URI","URLScraper","AsyncRequest","XGroupSellNUXPostToMarketplaceDialogController","getOrCreateDOMID","csx","cx","setImmediate"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){b.__markCompiled&&b.__markCompiled();var aa={initSellInputs:function(ba){this._isUploadingPhotos=false;this._composerSubmitted=false;var ca=k.scry(this._root,"._4t9g");if(ca.length>0)this._postOnMarketplaceCheckBox=ca[0];var da=this.getComponent('forsale').instance;if(this._linkShare){l.set(this._getDescriptionTextarea());}else if(!this._config.isDefaultComposer)l.set(da.getTitleInput());this._inputsEverChanged={title:false,price:false,description:false,pickupNote:false,category:false,submitEnabled:false,launchedSellComposer:false};if(this._sellInputListeners){this._sellInputListeners.release();this._sellInputListeners=null;}if(this._descriptionFocusListener){this._descriptionFocusListener.remove();this._descriptionFocusListener=null;}this._sellInputListeners=new r();this._sellInputListeners.addSubscriptions(n.listen(da.getTitleInput(),'input',this._inputsChanged.bind(this)),n.listen(da.getTitleInput(),'change',this._inputsChanged.bind(this)),n.listen(da.getPriceInput(),'input',this._inputsChanged.bind(this)),n.listen(da.getPriceInput(),'change',this._inputsChanged.bind(this)),n.listen(this.getComponent('maininput').element,'input',this._inputsChanged.bind(this)),n.listen(this.getComponent('maininput').element,'change',this._inputsChanged.bind(this)),n.listen(da.getPickupNoteInput(),'input',this._inputsChanged.bind(this)),n.listen(da.getPickupNoteInput(),'change',this._inputsChanged.bind(this)),da.subscribe('categoryChanged',this._inputsChanged.bind(this)),n.listen(this.getSubmitButton(),'click',this._submitButtonClicked.bind(this)));if(this._taggingFlyoutData&&this._taggingFlyoutData.recognitionController)this._sellInputListeners.addSubscriptions(this._taggingFlyoutData.recognitionController.subscribe('done',this._inputsChanged.bind(this)));var ea=k.scry(this._root,"._9s")[0];if(ea)this._sellInputListeners.addSubscriptions(n.listen(ea,'click',this._removeLinkAttachment.bind(this)));this._urlScraper=new t(this.getComponent('maininput').element,function(){return this.getComponent('maininput').instance.getValue();}.bind(this));this._scraperListener=this._urlScraper.subscribe('match',function(ga,ha){if(this._hasPhotos||ea||this._config.isEditComposer)return;var ia=new s(this._config.scraperEndpoint);ia.addQueryData({scrape_url:encodeURIComponent(ha.url)});h.getAttachment(this._root,ia.toString());}.bind(this));this.setHasPhotos(this.getPhotoCount()>0);this.getScrollableArea().setPlaceholderHandler(function(){});if(ba)p.log(this._config.targetID,o.COMPOSER_LOAD,this._config.isEditComposer);this._logLaunchSellComposer();this._sellComposerInited=true;this._inputsChanged();var fa=this.getComponent('maininput');da.setInitialData(fa.instance.getValue(),false);},supportsDragDrop:function(){return false;},resetSellInputs:function(){if(this._sellInputListeners){this._sellInputListeners.release();this._sellInputListeners=null;}if(this._urlScraper){this._urlScraper.disable();this._urlScraper.reset();this._urlScraper=null;}if(this._descriptionFocusListener){this._descriptionFocusListener.remove();this._descriptionFocusListener=null;}var ba=q.byClass(this._root,"child_was_focused");if(ba)i.removeClass(ba,"child_was_focused");this._isUploadingPhotos=false;this._composerSubmitted=false;},cleanupSellInputs:function(){if(this._scraperListener){this._scraperListener.unsubscribe();this._scraperListener=null;}if(!this._descriptionFocusListener)this._descriptionFocusListener=n.listen(this._getDescriptionTextarea(),'focus',function(){this._descriptionFocusListener.remove();this._descriptionFocusListener=null;if(this._nuxTooltip)this._nuxTooltip.show();}.bind(this));},_inputsChanged:function(){if(!this._sellComposerInited)return;var ba=this.getComponent('forsale').instance,ca=m.isEmpty(ba.getTitleInput()),da=m.isEmpty(ba.getHiddenPriceInput()),ea=ba.requiresCategory(),fa=ba.hasCategory(),ga=this.getComponent('maininput').instance,ha=!ga.getValue(),ia=m.isEmpty(ba.getPickupNoteInput());if(!this._inputsEverChanged.title&&!ca){p.log(this._config.targetID,o.COMPOSER_FILL_TITLE,this._config.isEditComposer);this._inputsEverChanged.title=true;}if(!this._inputsEverChanged.price&&!da){p.log(this._config.targetID,o.COMPOSER_FILL_PRICE,this._config.isEditComposer);this._inputsEverChanged.price=true;}if(!this._inputsEverChanged.description&&!ha){p.log(this._config.targetID,o.COMPOSER_FILL_DESCRIPTION,this._config.isEditComposer);this._inputsEverChanged.description=true;}if(!this._inputsEverChanged.pickupNote&&!ia){p.log(this._config.targetID,o.COMPOSER_FILL_PICKUP_NOTE,this._config.isEditComposer);this._inputsEverChanged.pickupNote=true;}if(!this._inputsEverChanged.category&&fa){p.log(this._config.targetID,o.COMPOSER_FILL_CATEGORY,this._config.isEditComposer);this._inputsEverChanged.category=true;}var ja=!this._isUploadingPhotos&&!this._composerSubmitted&&!ca&&!da&&(!ea||fa),ka=this.getSubmitButton().parentNode,la=k.find(ka,"._314l");i.conditionShow(la,!ja);if(!this._inputsEverChanged.submitEnabled&&ja){this._inputsEverChanged.submitEnabled=true;p.log(this._config.targetID,o.COMPOSER_SUBMIT_ENABLED,this._config.isEditComposer);}this._setSubmitButtonEnabled(ja);},_removeLinkAttachment:function(){if(!this._linkShare)return;k.remove(this._linkShare);this._linkShare=null;this._urlScraper.disable();},startedUploadingPhotos:function(){this._isUploadingPhotos=true;this._inputsChanged();},finishedUploadingPhotos:function(){this._isUploadingPhotos=false;this._inputsChanged();},setHasPhotos:function(ba){this._hasPhotos=ba;if(ba)this._removeLinkAttachment();},_getDescriptionTextarea:function(){return k.find(this.getComponent('maininput').element,'textarea.input');},_submitButtonClicked:function(ba){this._composerSubmitted=true;this._logComposerSubmitted();if(this._postOnMarketplaceCheckBox&&!this._postOnMarketplaceCheckBox.checked){ba.preventDefault();var ca=document.getElementsByName('marketplace_from_group_id'),da=ca[0].value,ea=this._postOnMarketplaceCheckBox.form,fa=k.create('button');fa.className='hidden_elem ';fa.type='submit';ea.appendChild(fa);var ga=v.getURIBuilder().setString('root_id',this._root.id).setString('checkbox_id',this._postOnMarketplaceCheckBox.id).setString('button_id',w(fa)).setString('group_id',da).getURI();new u().setURI(ga).send();}z(this._inputsChanged.bind(this));},_logLaunchSellComposer:function(){var ba=q.byClass(this._root,"focus_target");if(i.hasClass(ba,'child_was_focused')){this._logComposerLaunched();}else{var ca=this.getComponent('forsale').instance;this._titleFocusHandler=n.listen(ca.getTitleInput(),'focus',this._logComposerLaunched.bind(this));}},_logComposerLaunched:function(){if(this._titleFocusHandler)this._titleFocusHandler.remove();if(this._inputsEverChanged.launchedSellComposer)return;this._inputsEverChanged.launchedSellComposer=true;p.log(this._config.targetID,o.LAUNCH_SELL_COMPOSER,this._config.isEditComposer);var ba=k.scry(this._root,"._4t9g");if(ba.length>0)p.log(this._config.targetID,o.SELL_COMPOSER_POST_TO_MARKETPLACE_SEEN,this._config.isEditComposer);g.inform('GroupSellComposer/launchedComposer');},_logComposerSubmitted:function(){var ba=this.getComponent('forsale').instance,ca=this.getComponent('maininput'),da=!!j.get(ca.element,'groupForSalePostIntercept')&&!j.get(ca.element,'groupForSalePostInterceptSubmit'),ea=parseFloat(m.getValue(ba.getHiddenPriceInput()))*100;p.logComposerSubmit(this._config.targetID,m.getValue(ba.getTitleInput()),m.getValue(ba.getCurrencyInput()),ea,ca.instance.getValue(),m.getValue(ba.getPickupNoteInput()),this.getPhotoCount(),this._config.isEditComposer,da);}};e.exports=aa;},null);
__d("ComposerXSellPlusAttachment",["ComposerXMediaUploadPlusAttachment","ComposerXSellAttachmentMixin","GroupSellComposerActionEvents","GroupSellComposerLogger","Parent","classWithMixins","cx","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=l(g,n(h));for(var p in o)if(o.hasOwnProperty(p))r[p]=o[p];var q=o===null?null:o.prototype;r.prototype=Object.create(q);r.prototype.constructor=r;r.__superConstructor__=o;function r(s,t,u,v,w){"use strict";o.call(this,s,t,u);this.attachmentClassName="_4_7-";this._linkShare=v;this._nuxTooltip=w;}r.prototype.initWithComponents=function(s){"use strict";q.initWithComponents.call(this);this.getTagger().hideTaggerIcons();this._root.action=this._config.statusEndpoint;this.initSellInputs(!!s);this.updateEndpoints();};r.prototype.persistUploadArea=function(){"use strict";return true;};r.prototype.reset=function(){"use strict";this.resetSellInputs();q.reset.call(this);};r.prototype.cleanup=function(){"use strict";this.cleanupSellInputs();this.getTagger().showTaggerIcons();this.resetSellInputs();q.cleanup.call(this);};r.prototype.canSwitchAway=function(){"use strict";return !k.byClass(this._root,'async_saving');};r.prototype._onUploadStart=function(){"use strict";q._onUploadStart.call(this);this.setHasPhotos(true);this.startedUploadingPhotos();};r.prototype._handleImageRemoved=function(s,t){"use strict";q._handleImageRemoved.call(this,s,t);this.updateEndpoints();j.log(this._config.targetID,i.COMPOSER_DELETE_PHOTO,this._config.isEditComposer);};r.prototype._handleImageAdded=function(s,t){"use strict";q._handleImageAdded.call(this,s,t);this.finishedUploadingPhotos();this.updateEndpoints();j.log(this._config.targetID,i.COMPOSER_ADD_PHOTO,this._config.isEditComposer);};r.prototype.updateEndpoints=function(){"use strict";if(this.getPhotoCount()>0&&!this._config.isEditComposer){this._root.action=this._config.photoEndpoint;this.setHasPhotos(true);}else{this._root.action=this._config.statusEndpoint;this.setHasPhotos(false);}};e.exports=r;},null);
__d("ComposerXCameraIconBehavior",["Arbiter","ComposerXMediaUploadHandler","CSS","Event","cx"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l={initCameraIcon:function(m){this._cameraIcon=m.getComponent('cameraicon');if(!this._config.showCameraIcon){i.hide(this._cameraIcon.element);return;}i.show(this._cameraIcon.element);var n=this._cameraIcon.instance,o=new h(this._config.composerID,{imagesOnly:this._config.imagesOnly,isEditComposer:this._config.isEditComposer,photoUploadOverrideEndpoint:this._config.photoUploadOverrideEndpoint});this._listeners.push(j.listen(this._cameraIcon.element,'click',function(){o.fetchAttachments();g.inform('cameraicon/click');}.bind(this)));this._subscriptions.push(n.subscribe('change',function(){o.handleFileSelected(n);i.addClass(this._cameraIcon.element,"_19_a");}.bind(this)));}};e.exports=l;},null);
__d("ComposerXPlusTagger",["ComposerXCameraIconBehavior","ComposerXStandardTagger","classWithMixins","mixin"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=i(h,j(g));for(var l in k)if(k.hasOwnProperty(l))n[l]=k[l];var m=k===null?null:k.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=k;function n(o){"use strict";k.call(this,o);this._eventuallyTagger=null;}n.prototype.init=function(o){"use strict";m.init.call(this,o);if(o.getComponent('cameraicon'))this.initCameraIcon(o);};n.prototype._nonObstrusiveSwitchToTagger=function(o){"use strict";var p=this._onTaggerShowCallbacks[o];delete this._onTaggerShowCallbacks[o];this.switchToTagger(o);this._dontHideTaggerOnMentionsFocus=o;this._onTaggerShowCallbacks[o]=p;};n.prototype.eventuallySwitchToTagger=function(o){"use strict";if(!this.isAnyTaggerShown()){this._nonObstrusiveSwitchToTagger(o);}else if(this._currentTagger!==o)this._eventuallyTagger=o;};n.prototype.switchToTagger=function(o){"use strict";if(this._eventuallyTagger===o)this._eventuallyTagger=null;this._nonEventuallyHideTaggers();this._showTagger(o);};n.prototype.hideTaggers=function(){"use strict";m.hideTaggers.call(this);if(this._eventuallyTagger){this._nonObstrusiveSwitchToTagger(this._eventuallyTagger);this._eventuallyTagger=null;}};n.prototype._nonEventuallyHideTaggers=function(){"use strict";m.hideTaggers.call(this);};n.prototype._hideTaggersFromMentionsInputClick=function(){"use strict";if(this._currentTagger!=this._dontHideTaggerOnMentionsFocus){this.eventuallySwitchToTagger(this._dontHideTaggerOnMentionsFocus);m._hideTaggersFromMentionsInputClick.call(this);}};e.exports=n;},null);
__d("ComposerXPlusTaggerWithOG",["ComposerXOGTaggerBehavior","ComposerXPlusTagger","classWithMixins","mixin"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=i(h,j(g));for(var l in k)if(k.hasOwnProperty(l))n[l]=k[l];var m=k===null?null:k.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=k;function n(){"use strict";if(k!==null)k.apply(this,arguments);}n.prototype.init=function(o){"use strict";m.init.call(this,o);this.initOGTagger(o);};n.prototype.cleanup=function(){"use strict";m.cleanup.call(this);this.cleanupOGTagger();};e.exports=n;},null);
__d("ComposerXOGTaggerReset",["CSS"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();function h(i){i.instance.reset();g.hide(i.element);}e.exports=h;},null);
__d("ComposerXPeopleTaggerReset",["CSS"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();function h(i){i.instance.reset();g.hide(i.element);}e.exports=h;},null);
__d("VaultComposerController",["Arbiter","CSS","SubscriptionsHandler","areEqual","emptyFunction","removeFromArray","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();function n(o,p){this._uploadedImageCount=0;this._uploadingImageCount=0;this._subscriptionsHandler=new i();this._hasVideo=false;this._singleSelect=false;this._multiselectElems=p;this._initialPhotoFbids=[];this._photoFbids=[];this.setAllMediaRemovedHandler(k);this._subscriptionsHandler.addSubscriptions(g.subscribe('multi-upload/images-added/'+o,function(q,r){var s=Object.keys(r.fbids),t=s.length;this._uploadingImageCount=Math.max(0,this._uploadingImageCount-t);this._uploadedImageCount+=t;if(this._uploadingImageCount>0)return;s.forEach(function(u){var v=r.fbids[u];this._photoFbids.push(v);if(r.initialPhoto)this._initialPhotoFbids.push(v);}.bind(this));this._onImagesChanged();}.bind(this)),g.subscribe('multi-upload/image-removed/'+o,function(q,r){this._uploadedImageCount=Math.max(0,this._uploadedImageCount-1);l(this._photoFbids,r);this._onImagesChanged();}.bind(this)),g.subscribe('multi-upload/images-upload-completed/'+o,function(q,r){this._uploadingImageCount=0;this._onImagesChanged();}.bind(this)),g.subscribe('multi-upload/video-added/'+o,function(){this._multiselectElems.forEach(h.hide);this._enableComposerHandler(true);this._placeholderHandler(m._("Say something about this video..."),m._("Where was this video taken?"));this._hasVideo=true;}.bind(this)),g.subscribe('multi-upload/video-removed/'+o,function(){this._multiselectElems.forEach(h.show);this._enableComposerHandler(false);this._placeholderHandler(m._("Say something about this..."),m._("Where was this taken?"));this._hasVideo=false;this._allMediaRemovedHandler();}.bind(this)),g.subscribe('multi-upload/images-upload-start/'+o,function(q,r){this._uploadingImageCount+=r.imageCount;this._enableComposerHandler(false);var s=this.getTotalImageCount();this._placeholderHandler(n.getPlaceholderText(s),n.getPlacePickerPlaceholderText(s));this._checkForSingleSelect();}.bind(this)),g.subscribe('multi-upload/all-images-removed/'+o,function(){this._multiselectElems.forEach(h.show);this._uploadedImageCount=0;this._uploadingImageCount=0;this._enableComposerHandler(false);this._placeholderHandler(m._("Say something about this..."),m._("Where was this taken?"));this._photoFbids.length=0;this._allMediaRemovedHandler();}.bind(this)));}Object.assign(n,{getPlaceholderText:function(o){if(o===0){return m._("Say something about this...");}else if(o==1){return m._("Say something about this photo...");}else return m._("Say something about these photos...");},getPlacePickerPlaceholderText:function(o){if(o===0){return m._("Where was this taken?");}else if(o==1){return m._("Where was this photo taken?");}else return m._("Where were these photos taken?");}});Object.assign(n.prototype,{setEnableComposerHandler:function(o){this._enableComposerHandler=o;return this;},setMultiselectElems:function(o){this._multiselectElems=o;return this;},setPlaceholderHandler:function(o){this._placeholderHandler=o;return this;},setAllMediaRemovedHandler:function(o){this._allMediaRemovedHandler=o;return this;},setSingleSelect:function(o){this._singleSelect=o;return this;},cleanup:function(){this._uploadedImageCount=0;this._uploadingImageCount=0;this._initialPhotoFbids.length=0;this._photoFbids.length=0;this._subscriptionsHandler.release();},_checkForSingleSelect:function(){if(this._singleSelect)this._multiselectElems.forEach(function(o){h.conditionShow(o,this.getTotalImageCount()===0);}.bind(this));},getTotalImageCount:function(){return this._uploadingImageCount+this._uploadedImageCount;},getUploadedImageCount:function(){return this._uploadedImageCount;},enableComposerHandlerIfHasImages:function(){this._enableComposerHandler(this._uploadedImageCount>0&&this._uploadingImageCount===0);},_onImagesChanged:function(){this.enableComposerHandlerIfHasImages();this._placeholderHandler(n.getPlaceholderText(this._uploadedImageCount),n.getPlacePickerPlaceholderText(this._uploadedImageCount));this._checkForSingleSelect();if(this._uploadedImageCount===0&&this._uploadingImageCount===0)this._allMediaRemovedHandler();},getPhotoFbids:function(){return this._photoFbids;},hasChanges:function(){var o=!j(this._photoFbids,this._initialPhotoFbids);return o||this._hasVideo;}});e.exports=n;},null);
__d("ComposerXUploadArea",["Arbiter","ComposerXController","CSS","DOM","PhotosMultiUploadInput","VaultComposerController","csx","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();function o(p,q,r){"use strict";this.$ComposerXUploadArea0=p;this.$ComposerXUploadArea1=q;this.$ComposerXUploadArea2=r;this.$ComposerXUploadArea3=0;}o.prototype.initialize=function(p,q,r,s,t){"use strict";this.$ComposerXUploadArea4=s;if(!this.$ComposerXUploadArea5)this.$ComposerXUploadArea5=new l(this.$ComposerXUploadArea4,p);this.$ComposerXUploadArea5.setSingleSelect(q.maxSelect===1).setPlaceholderHandler(this.setPlaceholderHandler.bind(this)).setMultiselectElems(p);h.registerConditionForComposerCancel(t,this.$ComposerXUploadArea5.hasChanges.bind(this.$ComposerXUploadArea5));this.$ComposerXUploadArea5.setMultiselectElems(p);};o.prototype.setEnableComposerHandler=function(p){"use strict";this.$ComposerXUploadArea5.setEnableComposerHandler(p);this.$ComposerXUploadArea5.enableComposerHandlerIfHasImages();return this;};o.prototype.setAllMediaRemovedHandler=function(p){"use strict";this.$ComposerXUploadArea5.setAllMediaRemovedHandler(p);return this;};o.prototype.setSingleSelect=function(p){"use strict";this.$ComposerXUploadArea5.setSingleSelect(p);return this;};o.prototype.setPlaceholderHandler=function(p){"use strict";this.$ComposerXUploadArea5.setPlaceholderHandler(p);return this;};o.prototype.getUploadArea=function(){"use strict";return this.$ComposerXUploadArea1;};o.prototype.getUploadItem=function(){"use strict";return this.$ComposerXUploadArea2;};o.prototype.getPhotoFbids=function(){"use strict";return this.$ComposerXUploadArea5?this.$ComposerXUploadArea5.getPhotoFbids():null;};o.prototype.handleImageAdded=function(p,q){"use strict";this.$ComposerXUploadArea6(this.getPhotoCount()+Object.keys(q.fbids).length);};o.prototype.handleImageRemoved=function(p,q){"use strict";this.$ComposerXUploadArea6(this.getPhotoCount()-1);};o.prototype.getTotalImageCount=function(){"use strict";return this.$ComposerXUploadArea5?this.$ComposerXUploadArea5.getTotalImageCount():0;};o.prototype.reset=function(){"use strict";g.inform('multi-upload/video-removed/'+this.$ComposerXUploadArea4);this.removeAllImages();};o.prototype.cleanup=function(){"use strict";this.reset();if(this.$ComposerXUploadArea5){this.$ComposerXUploadArea5.cleanup();this.$ComposerXUploadArea5=null;}};o.prototype.$ComposerXUploadArea6=function(p){"use strict";this.$ComposerXUploadArea3=p;};o.prototype.getPhotoCount=function(){"use strict";return this.$ComposerXUploadArea3;};o.prototype.getController=function(){"use strict";return this.$ComposerXUploadArea5;};o.prototype.removeAllImages=function(){"use strict";this.$ComposerXUploadArea6(0);j.scry(this.$ComposerXUploadArea0,"._yr").forEach(function(q){if(!i.hasClass(q,"_2oh"))j.remove(q);});j.scry(this.$ComposerXUploadArea0,"._579").forEach(function(q){if(!i.hasClass(q,"_2oh"))j.remove(q);});var p=this.$ComposerXUploadArea2.getUploadInput().getGrid();if(p){p.clearSession();}else k.clearSession(this.$ComposerXUploadArea4);g.inform(['multi-upload/all-images-removed/'+this.$ComposerXUploadArea4,'multi-upload/all-images-removed']);};e.exports=o;},null);
__d("GroupSellInterceptUtil",["escapeRegex"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={parseInterceptedPrices:function(i,j){var k=new RegExp('\\d+','ig'),l=new RegExp(g(j)+'\\s*\\d+','ig'),m=new RegExp('\\d+(?=\\s*'+g(j)+')','ig'),n=[],o=i.match(l);if(o)o.forEach(function(p){return n=n.concat(p.match(k));});o=i.match(m);if(o)n=n.concat(o);return n;}};e.exports=h;},null);
__d("ComposerXForSaleComponent",["Currency","AdsCurrencyFormatter","ArbiterMixin","ContextualLayer","CSS","DataStore","Event","GroupSellInterceptUtil","Input","LayerHideOnBlur","SubscriptionsHandler","cx","fbt","getActiveElement","getElementText","invariant","mixin","setTextContent"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){b.__markCompiled&&b.__markCompiled();var y=w(i);for(var z in y)if(y.hasOwnProperty(z))ba[z]=y[z];var aa=y===null?null:y.prototype;ba.prototype=Object.create(aa);ba.prototype.constructor=ba;ba.__superConstructor__=y;function ba(ca,da,ea){"use strict";y.call(this);this._inputs=ca;this._charCounts=da;this._options=ea;this._currency=ea.currencies[0];v(this._currency);this._currencySymbol=g.getSymbol(this._currency);v(this._currencySymbol);var fa=this._inputs.title,ga=this._inputs.price,ha=this._inputs.pickupNote;this._subscriptions=new q();this._subscriptions.addSubscriptions(m.listen(fa,'input',this._titleChanged.bind(this)),m.listen(fa,'change',this._titleChanged.bind(this)),m.listen(fa,'focus',this._titleFocusChanged.bind(this)),m.listen(fa,'blur',this._titleFocusChanged.bind(this)),m.listen(ga,'focus',this._priceFocused.bind(this)),m.listen(ga,'input',this._priceChanged.bind(this)),m.listen(ga,'change',this._priceChanged.bind(this)),m.listen(ga,'blur',this._priceBlurred.bind(this)));if(this._charCounts.pickupNote)this._subscriptions.addSubscriptions(m.listen(ha,'input',this._pickupNoteChanged.bind(this)),m.listen(ha,'change',this._pickupNoteChanged.bind(this)),m.listen(ha,'focus',this._pickupNoteFocusChanged.bind(this)),m.listen(ha,'blur',this._pickupNoteFocusChanged.bind(this)));o.setValue(this._inputs.hiddenCurrency,this._currency);this._priceChanged();this._priceBlurred();this._titleChanged();this._titleFocusChanged();if(this._charCounts.pickupNote){this._pickupNoteChanged();this._pickupNoteFocusChanged();}if(this._inputs.selectCategory){k.removeClass(this._inputs.categoriesDropdown,"hidden_elem");this._subscriptions=new q();this._subscriptions.addSubscriptions(m.listen(this._inputs.selectCategory,'click',this._handleSelectCategory.bind(this)),m.listen(this._inputs.categoriesDropdown,'click',this._handleCategoryClick.bind(this)));this._layer=new j({context:this._inputs.selectCategory,position:'below',alignment:'left'},this._inputs.categoriesDropdown);this._layer.enableBehavior(p);}}ba.prototype._titleChanged=function(){"use strict";var ca=o.getValue(this._inputs.title).trim(),da=this._options.inputMaxChars-ca.length;x(this._charCounts.title,da);};ba.prototype._titleFocusChanged=function(){"use strict";k.conditionShow(this._charCounts.title,t()===this._inputs.title);};ba.prototype._priceFocused=function(){"use strict";if(o.isEmpty(this._inputs.price))o.setValue(this._inputs.price,this._currencySymbol);};ba.prototype.setInitialData=function(ca,da){"use strict";this.setInitialPriceIfEmpty(ca,da);if(da){var ea=ca.length,fa=ca.substr(0,Math.min(30,ea));if(fa.length<ea)fa=fa.concat('...');var ga=this._options.everyThingElseCategoryID.toString();o.setValue(this._inputs.title,fa);if(this.requiresCategory())this._setCategory(ga,u(this._options.everythingElseCategory));}};ba.prototype.setInitialPriceIfEmpty=function(ca,da){"use strict";var ea=this._getPriceValue();if(!ea){var fa=n.parseInterceptedPrices(ca,this._currencySymbol);if(fa.length){o.setValue(this._inputs.price,fa[0]);this._priceChanged();}else if(da)this._inputs.price.focus();}};ba.prototype._priceChanged=function(){"use strict";var ca=this._getPriceValue();if(ca==null){o.setValue(this._inputs.hiddenPrice,'');o.setValue(this._inputs.price,this._currencySymbol);return;}o.setValue(this._inputs.hiddenPrice,''+ca);var da=g.getOffset(this._currency),ea=h.formatCurrencyWithOptionalDecimals(this._currency,ca*da);if(ea!==o.getValue(this._inputs.price))o.setValue(this._inputs.price,ea);};ba.prototype._priceBlurred=function(){"use strict";var ca=this._getPriceValue();if(ca==null)o.reset(this._inputs.price);};ba.prototype._getPriceValue=function(){"use strict";var ca=o.getValue(this._inputs.price),da=ca.replace(/\D/g,'');if(!da.length){return null;}else return parseInt(da,10);};ba.prototype._pickupNoteChanged=function(){"use strict";var ca=o.getValue(this._inputs.pickupNote).trim();x(this._charCounts.pickupNote,this._options.inputMaxChars-ca.length);};ba.prototype._pickupNoteFocusChanged=function(){"use strict";k.conditionShow(this._charCounts.pickupNote,t()===this._inputs.pickupNote);};ba.prototype.requiresCategory=function(){"use strict";return !!this._inputs.selectCategory;};ba.prototype.hasCategory=function(){"use strict";return (!!this._inputs.categoryIDInput&&!!o.getValue(this._inputs.categoryIDInput));};ba.prototype._handleSelectCategory=function(){"use strict";this._layer.show();};ba.prototype._handleCategoryClick=function(event){"use strict";var ca=l.get(event.target,'categoryID');if(ca){this._setCategory(ca,u(event.target));this._layer.hide();}};ba.prototype._setCategory=function(ca,da){"use strict";o.setValue(this._inputs.categoryIDInput,ca);x(this._inputs.selectCategory,da);k.addClass(this._inputs.selectCategory,"_4oxb");this.inform('categoryChanged');};ba.prototype.reset=function(){"use strict";o.reset(this._inputs.title);o.reset(this._inputs.price);o.reset(this._inputs.hiddenPrice);if(this._charCounts.pickupNote)o.reset(this._inputs.pickupNote);this._charCounts.title.innerText=this._options.inputMaxChars;if(this._charCounts.pickupNote)this._charCounts.pickupNote.innerText=this._options.inputMaxChars;if(this._inputs.categoryIDInput){o.reset(this._inputs.categoryIDInput);x(this._inputs.selectCategory,s._("Select a Category"));k.removeClass(this._inputs.selectCategory,"_4oxb");}};ba.prototype.getTitleInput=function(){"use strict";return this._inputs.title;};ba.prototype.getPriceInput=function(){"use strict";return this._inputs.price;};ba.prototype.getCurrencyInput=function(){"use strict";return this._inputs.hiddenCurrency;};ba.prototype.getHiddenPriceInput=function(){"use strict";return this._inputs.hiddenPrice;};ba.prototype.getPickupNoteInput=function(){"use strict";return this._inputs.pickupNote;};e.exports=ba;},null);
__d("ComposerXForSaleExtrasComponent",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(){"use strict";}g.prototype.reset=function(){"use strict";};e.exports=g;},null);
__d("VaultGridUploadItem",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(h){"use strict";this.$VaultGridUploadItem0=h;}g.prototype.getUploadInput=function(){"use strict";return this.$VaultGridUploadItem0;};e.exports=g;},null);